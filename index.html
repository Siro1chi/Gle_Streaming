<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>–ì–ª–µ-–°—Ç—Ä–∏–º ¬∑ –°–∏–º—É–ª—è—Ç–æ—Ä —Å—Ç—Ä–∏–º–µ—Ä–∞</title>
    <style>
        /* ========== –ü–û–õ–ù–´–ô –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ô CSS –ü–û–î –ú–û–ë–ò–õ–ö–ò ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: radial-gradient(circle at top, #0a1a0a, #030803);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .game-container {
            max-width: 480px;
            width: 100%;
            background: rgba(10, 20, 10, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            box-shadow: 0 0 25px rgba(0, 255, 0, 0.1);
            padding: 16px 14px;
            border: 1px solid #2a4a2a;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        /* ===== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ===== */
        .stats-row {
            display: grid;
            grid-template-columns: 1.8fr 1fr;
            gap: 8px;
            width: 100%;
        }

        .subs-block, .cash-block {
            background: #0e1a0e;
            border-radius: 18px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 0;
        }
        .subs-block { border: 1.5px solid #3a7a3a; }
        .cash-block { border: 1.5px solid #ffd700; }

        .subs-icon, .cash-icon {
            width: 40px; height: 40px;
            background: #1a3a1a;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            border-bottom: 3px solid #0a2e0a;
            flex-shrink: 0;
        }
        .cash-icon { background: #3a3a1a; }

        .subs-info { flex: 1; min-width: 0; }
        .subs-label {
            font-size: 11px;
            color: #8bc34a;
            text-transform: uppercase;
        }
        .subs-value {
            font-size: 26px;
            font-weight: 800;
            color: #c8ffb0;
            text-shadow: 0 0 8px #00aa00;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .cash-value {
            font-size: 20px;
            font-weight: 700;
            color: #ffd700;
            text-shadow: 0 0 8px #aa8800;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .cash-block span:last-child {
            flex-shrink: 0;
            font-size: 13px;
        }

        /* ===== –ö–õ–ò–ö–ï–† ===== */
        .click-area {
            display: flex;
            justify-content: center;
        }
        .click-btn {
            background: linear-gradient(145deg, #1a4a1a, #0a2a0a);
            border: none;
            border-bottom: 5px solid #00aa00;
            color: white;
            font-size: 22px;
            font-weight: 700;
            padding: 14px 30px;
            border-radius: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 6px 0 #004400, 0 0 25px #00aa00;
            width: 100%;
            max-width: 280px;
            letter-spacing: 1.5px;
            transition: transform 0.05s, box-shadow 0.05s, border-bottom-width 0.05s;
            touch-action: auto;
            min-height: 52px;
        }
        .click-btn:active {
            transform: translateY(5px);
            box-shadow: 0 1px 0 #004400, 0 0 35px #00ff00;
            border-bottom-width: 1px;
        }

        /* ===== –ü–ê–°–°–ò–í–ù–´–ô –î–û–•–û–î –ò –ü–†–û–ì–†–ï–°–° ===== */
        .passive-stats {
            background: #0e1a0e;
            border-radius: 16px;
            padding: 10px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #2a5a2a;
            color: #a0e0a0;
            font-size: 14px;
        }
        .per-second {
            background: #1a3a1a;
            color: #d4ff78;
            padding: 5px 16px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 15px;
            border: 1px solid #7ac77a;
            box-shadow: 0 0 8px #00aa00;
        }

        /* ===== –ü–†–ï–°–¢–ò–ñ ===== */
        .prestige-section {
            background: linear-gradient(145deg, #0e2a0e, #051005);
            border-radius: 20px;
            padding: 14px;
            border: 1.5px solid #d4af37;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .prestige-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: #ffd700;
        }
        .prestige-title h3 {
            font-size: 20px;
            font-weight: 800;
            text-shadow: 0 0 8px #aa8800;
        }
        .prestige-button {
            background: linear-gradient(145deg, #d4af37, #9e8b3c);
            border: none;
            border-bottom: 5px solid #6b5a2a;
            color: #0a1a0a;
            font-weight: 800;
            font-size: 18px;
            padding: 12px 20px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 5px 0 #4a3a1a, 0 0 18px #ffd700;
            transition: all 0.05s;
            width: 100%;
            min-height: 48px;
        }
        .prestige-button:active {
            transform: translateY(5px);
            box-shadow: 0 1px 0 #4a3a1a, 0 0 25px #ffff00;
            border-bottom-width: 1px;
        }
        .prestige-button:disabled {
            opacity: 0.5;
            box-shadow: none;
            transform: none;
            pointer-events: none;
        }
        .progress-bar {
            background: #1a2a1a;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffaa00);
            width: 0%;
            transition: width 0.2s;
        }

        /* ===== –ü–ï–†–°–û–ù–ê–ñ ===== */
        .character-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #0e1a0e;
            border-radius: 18px;
            padding: 8px 14px;
            border: 1.5px solid #7a3a7a;
            cursor: pointer;
            min-height: 52px;
        }
        .character-avatar {
            background: linear-gradient(145deg, #2a1a2a, #1a0a1a);
            width: 48px;
            height: 48px;
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            border: 2px solid #c8a0ff;
            box-shadow: 0 0 15px #aa88ff;
            flex-shrink: 0;
        }
        .character-info {
            flex: 1;
            margin-left: 12px;
            color: #e0c0ff;
            min-width: 0;
        }
        .character-name {
            font-weight: 700;
            font-size: 16px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .character-bonus {
            font-size: 12px;
            color: #d0a0ff;
        }
        .gem-indicator {
            background: #1a2a4a;
            padding: 6px 12px;
            border-radius: 30px;
            color: #aad4ff;
            border: 1px solid #5a9aff;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            flex-shrink: 0;
        }

        /* ===== –ö–û–ù–¢–ï–ù–¢ ===== */
        .content-title {
            font-size: 18px;
            font-weight: 700;
            color: #a0e0a0;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 2px solid #2a5a2a;
            padding-bottom: 8px;
            margin-bottom: 8px;
        }
        .content-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 320px;
            overflow-y: auto;
            padding-right: 2px;
        }
        .content-item {
            background: #0e1a0e;
            border-radius: 18px;
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1.5px solid #2a5a2a;
            transition: all 0.1s;
            gap: 10px;
        }
        .content-info {
            flex: 1;
            min-width: 0;
        }
        .content-name {
            font-weight: 700;
            font-size: 16px;
            color: #e0ffe0;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 4px;
            flex-wrap: wrap;
        }
        .level-badge {
            background: #1a4a1a;
            border-radius: 30px;
            padding: 3px 10px;
            font-size: 12px;
            font-weight: 600;
            color: #c8ffa0;
            border: 1px solid #5a9a5a;
        }
        .content-effects {
            font-size: 12px;
            color: #b0dab0;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .effect-badge {
            background: #1a2a1a;
            padding: 3px 10px;
            border-radius: 30px;
            font-weight: 500;
            border: 1px solid #5a8a5a;
            font-size: 11px;
        }
        .content-price {
            background: linear-gradient(145deg, #1e4a1e, #0a2e0a);
            color: #ffd700;
            padding: 8px 12px;
            border-radius: 16px;
            font-weight: 700;
            font-size: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 90px;
            text-align: center;
            border: none;
            border-bottom: 4px solid #004400;
            transition: all 0.05s;
            cursor: pointer;
            min-height: 52px;
        }
        .content-price:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }
        .content-price:disabled {
            opacity: 0.5;
            transform: none;
            pointer-events: none;
        }
        .price-small {
            font-size: 11px;
            color: #a0d0a0;
            font-weight: 400;
        }

        /* ===== –ú–û–î–ê–õ–ö–ê ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(8px);
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 12px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: linear-gradient(145deg, #1a2a1a, #0a1a0a);
            border-radius: 28px;
            padding: 20px;
            max-width: 400px;
            width: 100%;
            border: 2px solid #c8a0ff;
            box-shadow: 0 0 40px #aa88ff;
            margin: auto;
        }
        .character-showcase {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }
        .big-avatar {
            width: 100px;
            height: 100px;
            background: linear-gradient(145deg, #2a1a2a, #1a0a1a);
            border-radius: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            border: 4px solid #e0c0ff;
            box-shadow: 0 0 35px #d0a0ff;
        }
        .skins-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 16px 0;
        }
        .skin-item {
            background: #0e1a0e;
            border: 1.5px solid #3a3a7a;
            border-radius: 16px;
            padding: 12px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            min-height: 90px;
        }
        .skin-item.owned {
            border-color: #ffd700;
            background: #1a2a1a;
            box-shadow: 0 0 10px #ffd700;
        }
        .skin-icon { font-size: 32px; }
        .skin-price {
            font-size: 13px;
            color: #aad4ff;
            display: flex;
            align-items: center;
            gap: 3px;
        }
        .close-modal {
            background: #3a1a1a;
            color: white;
            border: none;
            border-bottom: 4px solid #5a2a2a;
            padding: 12px 20px;
            border-radius: 18px;
            font-weight: 700;
            width: 100%;
            margin-top: 8px;
            cursor: pointer;
            min-height: 48px;
        }
        .reset-button {
            background: linear-gradient(145deg, #4a1a1a, #2a0a0a);
            border: none;
            border-bottom: 5px solid #6b2a2a;
            color: white;
            font-weight: 700;
            font-size: 15px;
            padding: 12px 20px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 5px 0 #3a1a1a, 0 0 12px #ff0000;
            width: 100%;
            cursor: pointer;
            min-height: 48px;
        }
        .reset-button:active {
            transform: translateY(5px);
            box-shadow: 0 1px 0 #3a1a1a, 0 0 20px #ff0000;
            border-bottom-width: 1px;
        }

        /* ===== –ï–ñ–ï–î–ù–ï–í–ù–ê–Ø –ù–ê–ì–†–ê–î–ê ===== */
        .daily-reward {
            background: #0e1a2a;
            border: 1px solid #5a9aff;
            border-radius: 16px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: #aad4ff;
        }
        .daily-reward button {
            background: #1a3a5a;
            border: none;
            border-bottom: 3px solid #0a2a4a;
            color: white;
            padding: 6px 15px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
        }
        .daily-reward button:disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        /* ===== –û–ë–£–ß–ï–ù–ò–ï ===== */
        .tutorial-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }
        .tutorial-card {
            background: #1a2a1a;
            border: 2px solid #7ac77a;
            border-radius: 28px;
            padding: 24px;
            max-width: 320px;
            text-align: center;
            color: white;
        }
        .tutorial-card h2 { color: #ffd700; margin-bottom: 12px; }
        .tutorial-card p { margin-bottom: 20px; color: #c0ffc0; }
        .tutorial-card button {
            background: #2a5a2a;
            border: none;
            border-bottom: 4px solid #0a3a0a;
            color: white;
            padding: 10px 30px;
            border-radius: 40px;
            font-weight: 700;
            cursor: pointer;
        }

        /* ===== –≠–ö–°–ü–û–†–¢/–ò–ú–ü–û–†–¢ ===== */
        .export-import {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .export-import button {
            flex: 1;
            background: #1a3a1a;
            border: none;
            border-bottom: 3px solid #0a2a0a;
            color: white;
            padding: 8px;
            border-radius: 16px;
            font-size: 13px;
            cursor: pointer;
        }

        /* ===== –ú–ï–î–ò–ê –ó–ê–ü–†–û–°–´ ===== */
        @media (max-width: 400px) {
            .stats-row { grid-template-columns: 1fr; }
            .subs-icon { width: 36px; height: 36px; font-size: 20px; }
            .subs-value { font-size: 24px; }
            .cash-value { font-size: 20px; }
            .click-btn { font-size: 20px; padding: 12px 24px; max-width: 260px; }
            .prestige-title h3 { font-size: 18px; }
            .character-avatar { width: 44px; height: 44px; font-size: 26px; }
            .content-list { max-height: 280px; }
        }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div class="game-container">
        <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
        <div class="stats-row">
            <div class="subs-block">
                <div class="subs-icon">üë•</div>
                <div class="subs-info">
                    <div class="subs-label">–ü–û–î–ü–ò–°–ß–ò–ö–ò</div>
                    <div class="subs-value" id="subsDisplay">0</div>
                </div>
            </div>
            <div class="cash-block">
                <span class="cash-icon">üí∞</span>
                <span class="cash-value" id="cashDisplay">0</span>
                <span>$</span>
            </div>
        </div>

        <!-- –ö–õ–ò–ö -->
        <div class="click-area">
            <button class="click-btn" id="clickButton">üé• –°–¢–†–ò–ú–ò–¢–¨ +1</button>
        </div>

        <!-- –ü–ê–°–°–ò–í–ù–´–ô –î–û–•–û–î –ò –ü–†–û–ì–†–ï–°–° –ü–†–ï–°–¢–ò–ñ–ê -->
        <div class="passive-stats">
            <span>üìä –ü–ê–°–°–ò–í–ù–´–ô –î–û–•–û–î</span>
            <span class="per-second" id="perSecondDisplay">+0.00 $/—Å–µ–∫</span>
        </div>
        <div id="prestigeProgressContainer" style="margin-top: -8px;">
            <div class="progress-bar"><div class="progress-fill" id="prestigeProgress" style="width:0%"></div></div>
        </div>

        <!-- –ü–ï–†–°–û–ù–ê–ñ -->
        <div class="character-section" id="characterButton">
            <div class="character-avatar" id="avatarEmoji">üé≠</div>
            <div class="character-info">
                <div class="character-name" id="characterName">–°—Ç—Ä–∏–º–µ—Ä</div>
                <div class="character-bonus" id="characterBonus">+0% –∫ –¥–æ—Ö–æ–¥—É</div>
            </div>
            <div class="gem-indicator">üíé <span id="gemsDisplay">0</span></div>
        </div>

        <!-- –ü–†–ï–°–¢–ò–ñ -->
        <div class="prestige-section">
            <div class="prestige-title">
                <h3>üî• –°–ú–ï–ù–ò–¢–¨ –§–û–†–ú–ê–¢</h3>
                <span id="nextContentPreview">‚Üí YouTab</span>
            </div>
            <button class="prestige-button" id="prestigeButton">
                ‚ö° –û–°–í–û–ò–¢–¨ –§–û–†–ú–ê–¢
                <span id="prestigeCostDisplay">1000 üë•</span>
            </button>
        </div>

        <!-- –ï–ñ–ï–î–ù–ï–í–ù–ê–Ø –ù–ê–ì–†–ê–î–ê -->
        <div class="daily-reward" id="dailyRewardBlock">
            <span>üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞</span>
            <button id="dailyRewardBtn" disabled>–ó–∞–±—Ä–∞—Ç—å</button>
        </div>

        <!-- –ö–û–ù–¢–ï–ù–¢ -->
        <div>
            <div class="content-title">üé¨ –ö–û–ù–¢–ï–ù–¢-–°–¢–£–î–ò–Ø</div>
            <div class="content-list" id="contentContainer"></div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–ö–ê –ü–ï–†–°–û–ù–ê–ñ–ê -->
    <div class="modal" id="characterModal">
        <div class="modal-content">
            <div class="character-showcase">
                <div class="big-avatar" id="modalAvatar">üé≠</div>
                <h2 style="color:#e0c0ff;" id="modalName">–°—Ç—Ä–∏–º–µ—Ä</h2>
                <div style="color:#ffd700; font-size:20px;">üíé <span id="modalGems">0</span></div>

                <div style="width:100%;">
                    <h3 style="color:#c0ffc0; margin-bottom:12px;">üé® –û–ë–†–ê–ó–´</h3>
                    <div class="skins-grid" id="skinsContainer"></div>
                </div>

                <!-- –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç -->
                <div class="export-import">
                    <button id="exportBtn">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
                    <button id="importBtn">üì• –ò–º–ø–æ—Ä—Ç</button>
                </div>
                <textarea id="importData" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è" style="width:100%; background:#1a1a1a; color:#0f0; border:1px solid #2a5a2a; border-radius:12px; padding:8px; margin-bottom:10px; display:none;"></textarea>

                <button class="close-modal" id="closeModalBtn">‚úï –ó–ê–ö–†–´–¢–¨</button>

                <div style="margin-top:20px; border-top:1px solid #2a5a2a; padding-top:16px;">
                    <h3 style="color:#ff6b6b;">‚ö†Ô∏è –û–ü–ê–°–ù–ê–Ø –ó–û–ù–ê</h3>
                    <button class="reset-button" id="resetGameBtn">üßπ –ü–û–õ–ù–´–ô –°–ë–†–û–°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –û–ë–£–ß–ï–ù–ò–ï (–±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ) -->
    <div id="tutorialOverlay" class="tutorial-overlay" style="display: none;">
        <div class="tutorial-card">
            <h2>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="tgUserName">–°—Ç—Ä–∏–º–µ—Ä</span>!</h2>
            <p>üîπ –ö–ª–∏–∫–∞–π ¬´–°–¢–†–ò–ú–ò–¢–¨¬ª, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤.<br>üîπ –ü–æ–∫—É–ø–∞–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞.<br>üîπ –û—Å–≤–∞–∏–≤–∞–π –Ω–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏ –ø–æ–ª—É—á–∞–π –≥–µ–º—ã.<br>üîπ –ü–æ–∫—É–ø–∞–π –æ–±—Ä–∞–∑—ã –∑–∞ –≥–µ–º—ã –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–π –¥–æ—Ö–æ–¥!</p>
            <button id="closeTutorial">–ü–æ–Ω—è—Ç–Ω–æ, –ø–æ–≥–Ω–∞–ª–∏!</button>
        </div>
    </div>

    <script>
        (function() {
            "use strict";

            // ---------- –ö–û–ù–°–¢–ê–ù–¢–´ ----------
            const CONFIG = {
                CONTENT_BASE_PRICE_SUBS: [100, 500, 1000, 2000, 5000],
                CONTENT_BASE_PRICE_CASH: [0, 0.25, 2, 10, 50],
                CONTENT_CASH_PER_SEC: [0.01, 0.05, 0.1, 0, 1],
                CONTENT_SUBS_PER_SEC: [0, 0.5, 5, 0, 0],
                CONTENT_CLICK_BONUS: [1, 0, 0, 10, 0],
                CONTENT_MULTIPLIER_TARGET: [null, null, null, 'youtab', null],
                CONTENT_MULTIPLIER_VALUE: [0, 0, 0, 0.25, 0],
                SKIN_PRICES: [0, 50, 100, 200, 500, 1000],
                SKIN_BONUS: [1.0, 1.1, 1.15, 1.2, 1.3, 1.4],
                PRESTIGE_REQ: [0, 500, 2000, 5000, 10000],
                DAILY_REWARD: [100, 50, 5] // [–ø–æ–¥–ø–∏—Å—á–∏–∫–∏, –¥–æ–ª–ª–∞—Ä—ã, –≥–µ–º—ã]
            };

            // ---------- –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ (–ö–õ–ê–°–°) ----------
            class Game {
                constructor() {
                    this.subscribers = 0;
                    this.cash = 0;
                    this.gems = 0;
                    this.prestigeLevel = 0;
                    this.globalBonus = 1.0;
                    this.clickPower = 1;
                    this.passiveCashPerSec = 0;
                    this.passiveSubsPerSec = 0;

                    // –ö–æ–Ω—Ç–µ–Ω—Ç: –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤
                    this.contentItems = [
                        { id: 'youtab', name: '–°—Ç—Ä–∏–º–∏–Ω–≥ –Ω–∞ YouTab', desc: '–°—Ç—Ä–∏–º–∏–Ω–≥ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞', count: 0, maxLevel: Infinity },
                        { id: 'tegigram', name: '–ü–æ—Å—Ç—ã –≤ Tegigram', desc: '–í–µ—Å—ë–ª—ã–µ –Ω–∞—Ä–µ–∑–∫–∏', count: 0, maxLevel: Infinity },
                        { id: 'kiktotk', name: '–†–æ–ª–∏–∫–∏ –≤ KikTotk', desc: '–ö–æ—Ä–æ—Ç–∫–∏–µ —Ä–æ–ª–∏–∫–∏', count: 0, maxLevel: Infinity },
                        { id: 'cosplay', name: '–ö–æ—Å–ø–ª–µ–π-—Å—Ç—Ä–∏–º—ã', desc: '–£—Å–∏–ª–∏–≤–∞–µ—Ç YouTab', count: 0, maxLevel: Infinity },
                        { id: 'spofifi', name: '–¢—Ä–µ–∫–∏ –≤ Spofifi', desc: '–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏', count: 0, maxLevel: Infinity }
                    ];

                    // –§–æ—Ä–º–∞—Ç—ã (–ø—Ä–µ—Å—Ç–∏–∂)
                    this.contentUnlocks = [
                        { id: 'youtab', name: 'üìπ YouTab', unlocked: true, subsReq: 0 },
                        { id: 'tegigram', name: 'üì± Tegigram', unlocked: false, subsReq: 500 },
                        { id: 'kiktotk', name: 'üéµ KikTotk', unlocked: false, subsReq: 2000 },
                        { id: 'cosplay', name: 'üßù –ö–æ—Å–ø–ª–µ–π', unlocked: false, subsReq: 5000 },
                        { id: 'spofifi', name: 'üéß Spofifi', unlocked: false, subsReq: 10000 }
                    ];

                    // –°–∫–∏–Ω—ã
                    this.skins = [
                        { id: 'default', name: '–ö–ª–∞—Å—Å–∏–∫–∞', emoji: 'üé≠', bonus: 1.0, price: 0, owned: true },
                        { id: 'cyber', name: '–ö–∏–±–µ—Ä', emoji: 'üëæ', bonus: 1.1, price: 50, owned: false },
                        { id: 'vampire', name: '–°—Ç—Ä–∏–º–µ—Ä-–≤–∞–º–ø–∏—Ä', emoji: 'üßõ', bonus: 1.15, price: 100, owned: false },
                        { id: 'robot', name: '–†–æ–±–æ', emoji: 'ü§ñ', bonus: 1.2, price: 200, owned: false },
                        { id: 'angel', name: '–ê–Ω–≥–µ–ª —ç—Ñ–∏—Ä–∞', emoji: 'üëº', bonus: 1.3, price: 500, owned: false },
                        { id: 'demon', name: '–î–µ–º–æ–Ω —Å—Ç—Ä–∏–º–∞', emoji: 'üòà', bonus: 1.4, price: 1000, owned: false }
                    ];

                    this.currentSkin = this.skins[0];

                    // –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞
                    this.lastDaily = 0; // timestamp

                    // –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–¥–ª—è UI)
                    this.listeners = [];
                }

                // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
                subscribe(fn) { this.listeners.push(fn); }
                notify(changedFields = []) {
                    this.listeners.forEach(fn => fn(changedFields));
                }

                // –ü–æ–ª—É—á–∏—Ç—å —Ü–µ–Ω—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                getContentPrice(contentId) {
                    const idx = this.contentItems.findIndex(c => c.id === contentId);
                    const item = this.contentItems[idx];
                    if (!item) return { subs: 0, cash: 0 };
                    const baseSubs = CONFIG.CONTENT_BASE_PRICE_SUBS[idx];
                    const baseCash = CONFIG.CONTENT_BASE_PRICE_CASH[idx];
                    const subsPrice = Math.floor(baseSubs * Math.pow(1.8, item.count));
                    const cashPrice = Math.floor(baseCash * Math.pow(1.6, item.count) * 100) / 100;
                    return { subs: subsPrice, cash: cashPrice };
                }

                // –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–µ—Å—Ç–∏–∂–∞
                getPrestigeCost() {
                    if (this.prestigeLevel >= this.contentUnlocks.length - 1) return Infinity;
                    return this.contentUnlocks[this.prestigeLevel + 1].subsReq;
                }

                // –ü–µ—Ä–µ—Å—á—ë—Ç –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞ –∏ —Å–∏–ª—ã –∫–ª–∏–∫–∞
                recalcStats() {
                    let totalCash = 0, totalSubs = 0, clickBonus = 0;

                    this.contentItems.forEach((content, idx) => {
                        totalCash += CONFIG.CONTENT_CASH_PER_SEC[idx] * content.count * this.globalBonus;
                        totalSubs += CONFIG.CONTENT_SUBS_PER_SEC[idx] * content.count * this.globalBonus;
                        clickBonus += CONFIG.CONTENT_CLICK_BONUS[idx] * content.count;
                    });

                    // –£—Å–∏–ª–µ–Ω–∏–µ –æ—Ç –∫–æ—Å–ø–ª–µ—è –¥–ª—è YouTab
                    const cosplayIdx = 3;
                    const youtabIdx = 0;
                    if (this.contentItems[cosplayIdx].count > 0) {
                        const multiplier = 1 + (this.contentItems[cosplayIdx].count * CONFIG.CONTENT_MULTIPLIER_VALUE[cosplayIdx]);
                        totalCash += CONFIG.CONTENT_CASH_PER_SEC[youtabIdx] * this.contentItems[youtabIdx].count * (multiplier - 1) * this.globalBonus;
                    }

                    this.passiveCashPerSec = totalCash;
                    this.passiveSubsPerSec = totalSubs;
                    this.clickPower = 1 + clickBonus;
                }

                // –ü–æ–∫—É–ø–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                purchaseContent(contentId) {
                    const content = this.contentItems.find(c => c.id === contentId);
                    if (!content) return;
                    const unlock = this.contentUnlocks.find(u => u.id === contentId);
                    if (!unlock || !unlock.unlocked) return;

                    const price = this.getContentPrice(contentId);
                    if (this.subscribers < price.subs || this.cash < price.cash) return;

                    this.subscribers -= price.subs;
                    this.cash -= price.cash;
                    content.count++;

                    this.recalcStats();
                    this.notify(['subscribers', 'cash', 'content', 'passive']);
                }

                // –ü—Ä–µ—Å—Ç–∏–∂
                prestige() {
                    const cost = this.getPrestigeCost();
                    if (this.prestigeLevel >= this.contentUnlocks.length - 1 || this.subscribers < cost) return;

                    this.subscribers -= cost;
                    this.prestigeLevel++;
                    this.contentUnlocks[this.prestigeLevel].unlocked = true;
                    this.gems += 25 + this.prestigeLevel * 10;

                    this.recalcStats();
                    this.notify(['subscribers', 'gems', 'prestige', 'unlocks', 'passive']);
                }

                // –ö–ª–∏–∫
                click() {
                    this.subscribers += this.clickPower * this.globalBonus;
                    this.notify(['subscribers']);
                }

                // –¢–∏–∫ –¥–æ—Ö–æ–¥–∞
                tick() {
                    if (this.passiveCashPerSec > 0) {
                        this.cash += this.passiveCashPerSec;
                    }
                    if (this.passiveSubsPerSec > 0) {
                        this.subscribers += this.passiveSubsPerSec;
                    }
                    this.notify(['cash', 'subscribers']);
                }

                // –ü–æ–∫—É–ø–∫–∞ —Å–∫–∏–Ω–∞
                purchaseSkin(skinId) {
                    const skin = this.skins.find(s => s.id === skinId);
                    if (!skin || skin.owned || this.gems < skin.price) return;
                    this.gems -= skin.price;
                    skin.owned = true;
                    this.notify(['gems', 'skins']);
                }

                // –í—ã–±–æ—Ä —Å–∫–∏–Ω–∞
                selectSkin(skinId) {
                    const skin = this.skins.find(s => s.id === skinId);
                    if (!skin || !skin.owned) return;
                    this.currentSkin = skin;
                    this.globalBonus = skin.bonus;
                    this.recalcStats();
                    this.notify(['skin', 'passive']);
                }

                // –ü–æ–ª—É—á–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –Ω–∞–≥—Ä–∞–¥—ã
                claimDaily() {
                    const now = Date.now();
                    if (now - this.lastDaily < 24 * 60 * 60 * 1000) return false;
                    this.lastDaily = now;
                    this.subscribers += CONFIG.DAILY_REWARD[0];
                    this.cash += CONFIG.DAILY_REWARD[1];
                    this.gems += CONFIG.DAILY_REWARD[2];
                    this.notify(['subscribers', 'cash', 'gems', 'daily']);
                    return true;
                }

                // –°–±—Ä–æ—Å –∏–≥—Ä—ã
                reset() {
                    this.subscribers = 0;
                    this.cash = 0;
                    this.gems = 0;
                    this.prestigeLevel = 0;
                    this.globalBonus = 1.0;
                    this.clickPower = 1;
                    this.passiveCashPerSec = 0;
                    this.passiveSubsPerSec = 0;
                    this.contentItems.forEach(c => c.count = 0);
                    this.contentUnlocks.forEach((u, i) => u.unlocked = i === 0);
                    this.skins.forEach((s, i) => s.owned = i === 0);
                    this.currentSkin = this.skins[0];
                    this.globalBonus = this.currentSkin.bonus;
                    this.lastDaily = 0;
                    this.recalcStats();
                    this.notify(['*']); // –≤—Å—ë –æ–±–Ω–æ–≤–∏—Ç—å
                }

                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ–±—ä–µ–∫—Ç
                toJSON() {
                    return {
                        subscribers: this.subscribers,
                        cash: this.cash,
                        gems: this.gems,
                        prestigeLevel: this.prestigeLevel,
                        globalBonus: this.globalBonus,
                        contentCounts: this.contentItems.map(c => c.count),
                        unlocks: this.contentUnlocks.map(u => u.unlocked),
                        skinsOwned: this.skins.map(s => s.owned),
                        currentSkinId: this.currentSkin.id,
                        lastDaily: this.lastDaily
                    };
                }

                // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –æ–±—ä–µ–∫—Ç–∞
                fromJSON(data) {
                    if (!data) return false;
                    try {
                        this.subscribers = data.subscribers || 0;
                        this.cash = data.cash || 0;
                        this.gems = data.gems || 0;
                        this.prestigeLevel = data.prestigeLevel || 0;
                        this.globalBonus = data.globalBonus || 1.0;
                        data.contentCounts?.forEach((count, i) => { if (this.contentItems[i]) this.contentItems[i].count = count; });
                        data.unlocks?.forEach((unlocked, i) => { if (this.contentUnlocks[i]) this.contentUnlocks[i].unlocked = unlocked; });
                        data.skinsOwned?.forEach((owned, i) => { if (this.skins[i]) this.skins[i].owned = owned; });
                        const savedSkin = this.skins.find(s => s.id === data.currentSkinId);
                        if (savedSkin) {
                            this.currentSkin = savedSkin;
                            this.globalBonus = savedSkin.bonus;
                        }
                        this.lastDaily = data.lastDaily || 0;
                        this.recalcStats();
                        return true;
                    } catch (e) { return false; }
                }
            }

            // ---------- –§–£–ù–ö–¶–ò–ò –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø ----------
            function formatNumber(num) {
                if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
                if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
                if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
                if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
                return Math.floor(num).toString();
            }

            // ---------- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ----------
            const game = new Game();

            // Telegram
            const tg = window.Telegram?.WebApp;
            if (tg) {
                tg.ready();
                tg.expand();
                tg.enableClosingConfirmation?.(); // –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage –∏ CloudStorage
            function loadFromStorage() {
                // —Å–Ω–∞—á–∞–ª–∞ –ª–æ–∫–∞–ª—å–Ω–æ
                const local = localStorage.getItem('glestream_save');
                let loaded = false;
                if (local) {
                    try {
                        loaded = game.fromJSON(JSON.parse(local));
                    } catch (e) {}
                }
                // –ø–æ—Ç–æ–º –∏–∑ –æ–±–ª–∞–∫–∞ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
                if (tg?.CloudStorage) {
                    tg.CloudStorage.getItem('glestream_save', (err, value) => {
                        if (!err && value) {
                            try {
                                game.fromJSON(JSON.parse(value));
                                updateAllUI(); // –ø–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                            } catch (e) {}
                        }
                    });
                }
                return loaded;
            }

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            function saveGame() {
                const data = game.toJSON();
                const str = JSON.stringify(data);
                localStorage.setItem('glestream_save', str);
                if (tg?.CloudStorage) {
                    tg.CloudStorage.setItem('glestream_save', str);
                }
            }

            // ---------- UI –≠–õ–ï–ú–ï–ù–¢–´ ----------
            const subsEl = document.getElementById('subsDisplay');
            const cashEl = document.getElementById('cashDisplay');
            const gemsEl = document.getElementById('gemsDisplay');
            const perSecEl = document.getElementById('perSecondDisplay');
            const avatarEmoji = document.getElementById('avatarEmoji');
            const characterName = document.getElementById('characterName');
            const characterBonus = document.getElementById('characterBonus');
            const prestigeCostDisplay = document.getElementById('prestigeCostDisplay');
            const nextContentPreview = document.getElementById('nextContentPreview');
            const prestigeBtn = document.getElementById('prestigeButton');
            const prestigeProgress = document.getElementById('prestigeProgress');
            const dailyBtn = document.getElementById('dailyRewardBtn');
            const tutorialOverlay = document.getElementById('tutorialOverlay');
            const tgUserNameSpan = document.getElementById('tgUserName');

            // –ú–æ–¥–∞–ª–∫–∞
            const modal = document.getElementById('characterModal');
            const modalAvatar = document.getElementById('modalAvatar');
            const modalName = document.getElementById('modalName');
            const modalGems = document.getElementById('modalGems');
            const skinsContainer = document.getElementById('skinsContainer');

            // ---------- –§–£–ù–ö–¶–ò–ò –û–ë–ù–û–í–õ–ï–ù–ò–Ø UI (–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ) ----------
            function updateUI(changedFields = []) {
                if (changedFields.includes('*') || changedFields.includes('subscribers')) {
                    subsEl.innerText = formatNumber(game.subscribers);
                }
                if (changedFields.includes('*') || changedFields.includes('cash')) {
                    cashEl.innerText = game.cash.toFixed(1);
                }
                if (changedFields.includes('*') || changedFields.includes('gems')) {
                    gemsEl.innerText = game.gems;
                    modalGems.innerText = game.gems;
                }
                if (changedFields.includes('*') || changedFields.includes('passive')) {
                    perSecEl.innerText = `+${game.passiveCashPerSec.toFixed(2)} $/—Å–µ–∫`;
                }
                if (changedFields.includes('*') || changedFields.includes('skin')) {
                    avatarEmoji.innerText = game.currentSkin.emoji;
                    modalAvatar.innerText = game.currentSkin.emoji;
                    characterName.innerText = `${game.currentSkin.name} –ì–ª–µ–±`;
                    const bonusPercent = ((game.currentSkin.bonus - 1) * 100).toFixed(0);
                    characterBonus.innerText = `+${bonusPercent}% –∫ –¥–æ—Ö–æ–¥—É`;
                }
                if (changedFields.includes('*') || changedFields.includes('prestige') || changedFields.includes('unlocks')) {
                    const cost = game.getPrestigeCost();
                    prestigeCostDisplay.innerHTML = (cost === Infinity ? 'MAX' : formatNumber(cost) + ' üë•');
                    const nextName = game.prestigeLevel >= game.contentUnlocks.length - 1 ? '–í—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã' : game.contentUnlocks[game.prestigeLevel + 1].name;
                    nextContentPreview.innerText = '‚Üí ' + nextName;
                    prestigeBtn.disabled = (game.prestigeLevel >= game.contentUnlocks.length - 1) || (game.subscribers < cost);
                    // –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
                    if (game.prestigeLevel < game.contentUnlocks.length - 1) {
                        const nextReq = game.getPrestigeCost();
                        const prevReq = game.contentUnlocks[game.prestigeLevel].subsReq;
                        const progress = Math.min(1, (game.subscribers - prevReq) / (nextReq - prevReq));
                        prestigeProgress.style.width = (progress * 100) + '%';
                    } else {
                        prestigeProgress.style.width = '100%';
                    }
                }
                if (changedFields.includes('*') || changedFields.includes('content')) {
                    renderContent();
                }
                if (changedFields.includes('*') || changedFields.includes('skins')) {
                    renderSkins();
                }
                if (changedFields.includes('*') || changedFields.includes('daily')) {
                    updateDailyButton();
                }
            }

            function renderContent() {
                let html = '';
                game.contentItems.forEach((content, idx) => {
                    if (!game.contentUnlocks[idx].unlocked) return;
                    const price = game.getContentPrice(content.id);
                    const canAfford = game.subscribers >= price.subs && game.cash >= price.cash;

                    let effects = [];
                    if (CONFIG.CONTENT_CASH_PER_SEC[idx] > 0) effects.push(`+${CONFIG.CONTENT_CASH_PER_SEC[idx] * game.globalBonus} $/—Å–µ–∫`);
                    if (CONFIG.CONTENT_SUBS_PER_SEC[idx] > 0) effects.push(`+${CONFIG.CONTENT_SUBS_PER_SEC[idx] * game.globalBonus} üë•/—Å–µ–∫`);
                    if (CONFIG.CONTENT_CLICK_BONUS[idx] > 0) effects.push(`+${CONFIG.CONTENT_CLICK_BONUS[idx]} üë• –∑–∞ –∫–ª–∏–∫`);
                    if (CONFIG.CONTENT_MULTIPLIER_TARGET[idx]) {
                        const targetName = game.contentItems.find(c => c.id === CONFIG.CONTENT_MULTIPLIER_TARGET[idx])?.name;
                        effects.push(`x${1 + content.count * CONFIG.CONTENT_MULTIPLIER_VALUE[idx]} –∫ ${targetName}`);
                    }

                    html += `
                        <div class="content-item">
                            <div class="content-info">
                                <div class="content-name">
                                    ${content.name}
                                    ${content.count > 0 ? `<span class="level-badge">Lv.${content.count}</span>` : ''}
                                </div>
                                <div class="content-effects">
                                    ${effects.map(e => `<span class="effect-badge">${e}</span>`).join('')}
                                </div>
                            </div>
                            <button class="content-price" data-content-id="${content.id}" ${!canAfford ? 'disabled' : ''}>
                                üíé ${formatNumber(price.subs)} üë•
                                ${price.cash > 0 ? `<br><span class="price-small">$${price.cash.toFixed(2)}</span>` : ''}
                                <span class="price-small">—É–ª—É—á—à–∏—Ç—å</span>
                            </button>
                        </div>
                    `;
                });
                document.getElementById('contentContainer').innerHTML = html;
                // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                document.querySelectorAll('.content-price').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.contentId;
                        game.purchaseContent(id);
                        saveGame();
                    });
                });
            }

            function renderSkins() {
                let html = '';
                game.skins.forEach(skin => {
                    html += `
                        <div class="skin-item ${skin.owned ? 'owned' : ''}" data-skin-id="${skin.id}">
                            <span class="skin-icon">${skin.emoji}</span>
                            <span style="color:#e0e0e0; font-size:12px;">${skin.name}</span>
                            ${skin.owned ? '<span style="color:#ffd700;">‚úì</span>' : 
                                `<span class="skin-price">üíé ${skin.price}</span>`}
                        </div>
                    `;
                });
                skinsContainer.innerHTML = html;
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                document.querySelectorAll('.skin-item').forEach(el => {
                    el.addEventListener('click', (e) => {
                        const skinId = el.dataset.skinId;
                        const skin = game.skins.find(s => s.id === skinId);
                        if (skin.owned) {
                            game.selectSkin(skinId);
                            saveGame();
                        } else {
                            game.purchaseSkin(skinId);
                            saveGame();
                        }
                        updateUI(['skins', 'skin', 'gems']);
                    });
                });
            }

            function updateDailyButton() {
                const now = Date.now();
                const diff = now - game.lastDaily;
                const canClaim = diff >= 24 * 60 * 60 * 1000;
                dailyBtn.disabled = !canClaim;
                dailyBtn.innerText = canClaim ? '–ó–∞–±—Ä–∞—Ç—å' : '–£–∂–µ —Å–µ–≥–æ–¥–Ω—è';
            }

            function updateAllUI() {
                updateUI(['*']);
            }

            // ---------- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ----------
            document.getElementById('clickButton').addEventListener('click', () => {
                game.click();
                saveGame();
                // –ê–Ω–∏–º–∞—Ü–∏—è –∏ —Ç–∞–∫—Ç–∏–ª—å–Ω–æ—Å—Ç—å
                if (tg?.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
                const btn = document.getElementById('clickButton');
                btn.style.transform = 'scale(0.95)';
                setTimeout(() => btn.style.transform = '', 100);
            });

            document.getElementById('prestigeButton').addEventListener('click', () => {
                game.prestige();
                saveGame();
                if (tg?.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            });

            document.getElementById('characterButton').addEventListener('click', () => {
                modal.classList.add('active');
                updateUI(['gems', 'skins']); // –æ–±–Ω–æ–≤–∏–º –¥–∞–Ω–Ω—ã–µ –≤ –º–æ–¥–∞–ª–∫–µ
            });

            document.getElementById('closeModalBtn').addEventListener('click', () => {
                modal.classList.remove('active');
            });

            document.getElementById('resetGameBtn').addEventListener('click', () => {
                if (confirm('üö® –¢–û–ß–ù–û –°–ë–†–û–°–ò–¢–¨?')) {
                    game.reset();
                    saveGame();
                    updateAllUI();
                    if (tg?.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
                }
            });

            // –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞
            dailyBtn.addEventListener('click', () => {
                if (game.claimDaily()) {
                    saveGame();
                    updateAllUI();
                    if (tg?.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                }
            });

            // –≠–∫—Å–ø–æ—Ä—Ç
            document.getElementById('exportBtn').addEventListener('click', () => {
                const data = game.toJSON();
                navigator.clipboard.writeText(JSON.stringify(data)).then(() => {
                    alert('–ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä');
                });
            });

            // –ò–º–ø–æ—Ä—Ç (–ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)
            const importText = document.getElementById('importData');
            document.getElementById('importBtn').addEventListener('click', () => {
                if (importText.style.display === 'none') {
                    importText.style.display = 'block';
                } else {
                    try {
                        const data = JSON.parse(importText.value);
                        game.fromJSON(data);
                        saveGame();
                        updateAllUI();
                        importText.style.display = 'none';
                        alert('–ò–º–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω');
                    } catch (e) {
                        alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞');
                    }
                }
            });

            // –û–±—É—á–µ–Ω–∏–µ
            document.getElementById('closeTutorial').addEventListener('click', () => {
                tutorialOverlay.style.display = 'none';
                localStorage.setItem('tutorial_shown', 'true');
            });

            // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
            game.subscribe(updateUI);

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            loadFromStorage();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—É—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –µ—â—ë –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏
            if (!localStorage.getItem('tutorial_shown')) {
                // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
                if (tg?.initDataUnsafe?.user?.first_name) {
                    tgUserNameSpan.innerText = tg.initDataUnsafe.user.first_name;
                }
                tutorialOverlay.style.display = 'flex';
            }

            // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–º—è –≤ –º–æ–¥–∞–ª–∫–µ
            if (tg?.initDataUnsafe?.user?.first_name) {
                document.getElementById('modalName').innerText = tg.initDataUnsafe.user.first_name + ' (–ì–ª–µ–±)';
            }

            // –¢–∞–π–º–µ—Ä –¥–æ—Ö–æ–¥–∞
            setInterval(() => {
                game.tick();
                saveGame();
            }, 1000);

            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            setInterval(saveGame, 30000);

            // –û–±–Ω–æ–≤–∏—Ç—å UI –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
            updateAllUI();
        })();
    </script>
</body>
</html>
